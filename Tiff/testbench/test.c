#include <stdio.h>
#include <stdint.h>
#include <string.h>
#include "vm.h"

// Test vectors for the VM, generated by stepping the VM one group at a time,
// starting at address 0.
// Command in Tiff is "N make ../templates/testbench.c ../testbench/test.c".
// Note that the registers/stacks will be hosed after test vector generation.

// Test vectors are embedded in a function
// Register IDs: 0 to 5 = T, N, RP, SP, UP, PC

int errors = 0;
int TestID;

// C testbench:

uint32_t ChangeRegs[2][6];              // rows: old, new
int changed;                            // list of registers to check
int tests = 0;

void RegChangeInit (void) {             // Initialize register changes
    for (int i=0; i<6; i++) {
        uint32_t x = vmRegRead(i);
        ChangeRegs[0][i] = x;
        ChangeRegs[1][i] = x;
    }
    ChangeRegs[1][5] -= 4;
    changed = 0;
}

void RegChanges (void) {				// process registor changes
    memmove(ChangeRegs[1], ChangeRegs[0], 6*sizeof(uint32_t));
    for (int i=0; i<6; i++) {           // [1] = expected, [0] = actual
        ChangeRegs[0][i] = vmRegRead(i);
    }
    int changed = 0;
    for (int i=0; i<6; i++) {           // compare...
        uint32_t actual   = ChangeRegs[0][i];
        uint32_t expected = ChangeRegs[1][i];
        if (actual != expected) {
            changed |= (1<<i);          // tag the registers changed
        }
    }
}

void newstep(uint32_t IR, int testID){
    if (changed) {
        printf("Unexpected changes detected in test %d: ", TestID);
        for (int i=0; i<6; i++) {
            if ((1<<i) & changed) {
                printf("%d ", i);
            }
        }
        printf("\n");
    }
    VMstep(IR, 0);
    RegChanges();
    TestID = testID;
    tests++;
};

void changes(int Reg, uint32_t actual){
	static uint32_t previous = 0;
    if (actual != ChangeRegs[0][Reg]) {
        errors++;
        printf("[%d]: New R%d: expected 0x%08X, is 0x%08X, old was 0x%08X\n",
               TestID, Reg, actual, ChangeRegs[0][Reg], previous);
    }
    changed &= ~(1<<Reg);               // tag as checked
	previous = actual;
};

int main()
{
	VMpor();
	RegChangeInit();

//           INS_GROUP  Test#
    newstep(0x4C0001D1, 0);  // PC = 0000h
    changes(5, 0x00000744);
    newstep(0x6C0001C5, 1);  // PC = 0744h
    changes(2, 0x000020FC);
    changes(5, 0x00000714);
    newstep(0x1B902218, 2);  // PC = 0714h
    changes(0, 0x00002218);
    changes(1, 0x00000748);
    changes(2, 0x00002100);
    changes(3, 0x00002078);
    newstep(0x96BE6200, 3);  // PC = 0718h
    changes(0, 0x00002200);
    changes(1, 0x00000000);
    changes(3, 0x0000207C);
    newstep(0xF7902100, 4);  // PC = 071Ch
    changes(0, 0x00002100);
    changes(4, 0x00002200);
    newstep(0x0790000C, 5);  // PC = 0720h
    changes(0, 0x0000000C);
    changes(1, 0x00002100);
    changes(3, 0x00002074);
    newstep(0xEA5AF540, 6);  // PC = 0724h
    changes(0, 0x00002100);
    changes(1, 0x00000000);
    changes(3, 0x00002100);
    newstep(0xE40021F0, 7);  // PC = 0728h
    changes(0, 0x000021F0);
    changes(1, 0x00002100);
    changes(3, 0x000020FC);
    newstep(0x07900008, 8);  // PC = 072Ch
    changes(0, 0x00000008);
    changes(1, 0x000021F0);
    changes(3, 0x000020F4);
    newstep(0xEA5AF904, 9);  // PC = 0730h
    changes(0, 0x00000004);
    changes(3, 0x000020F8);
    newstep(0x2ED6C0CA, 10);  // PC = 0734h
    changes(0, 0x00002100);
    changes(1, 0x00000000);
    changes(2, 0x000021E8);
    changes(3, 0x00002100);
    changes(5, 0x00000328);
    newstep(0x09000000, 11);  // PC = 0328h
    changes(2, 0x000021EC);
    changes(5, 0x00000738);
    newstep(0x6C0000ED, 12);  // PC = 0738h
    changes(2, 0x000021E8);
    changes(5, 0x000003B4);
    newstep(0xE40003A0, 13);  // PC = 03B4h
    changes(0, 0x000003A0);
    changes(1, 0x00002100);
    changes(3, 0x000020FC);
    newstep(0xE4002234, 14);  // PC = 03B8h
    changes(0, 0x00002234);
    changes(1, 0x000003A0);
    changes(3, 0x000020F8);
    newstep(0x96B09000, 15);  // PC = 03BCh
    changes(0, 0x00002100);
    changes(1, 0x00000000);
    changes(2, 0x000021EC);
    changes(3, 0x00002100);
    changes(5, 0x0000073C);
    newstep(0xE4002218, 16);  // PC = 073Ch
    changes(0, 0x00002218);
    changes(1, 0x00002100);
    changes(3, 0x000020FC);
    newstep(0xB9A4C047, 17);  // PC = 0740h
    changes(0, 0x00002100);
    changes(1, 0x00000000);
    changes(2, 0x000021E8);
    changes(3, 0x00002100);
    changes(5, 0x0000011C);
    newstep(0xE400000A, 18);  // PC = 011Ch
    changes(0, 0x0000000A);
    changes(1, 0x00002100);
    changes(3, 0x000020FC);
    newstep(0xE4002218, 19);  // PC = 0120h
    changes(0, 0x00002218);
    changes(1, 0x0000000A);
    changes(3, 0x000020F8);
    newstep(0x96B09000, 20);  // PC = 0124h
    changes(0, 0x00002100);
    changes(1, 0x00000000);
    changes(2, 0x000021EC);
    changes(3, 0x00002100);
    changes(5, 0x00000748);
    newstep(0x4C0001D6, 21);  // PC = 0748h
    changes(5, 0x00000758);
    newstep(0xE400074C, 22);  // PC = 0758h
    changes(0, 0x0000074C);
    changes(1, 0x00002100);
    changes(3, 0x000020FC);
    newstep(0x39B000DB, 23);  // PC = 075Ch
    changes(0, 0x0000000B);
    changes(1, 0x0000074D);
    changes(2, 0x000021E8);
    changes(3, 0x000020F8);
    changes(5, 0x0000036C);
    newstep(0x4C000119, 24);  // PC = 036Ch
    changes(5, 0x00000464);
    newstep(0x07F27F14, 25);  // PC = 0464h
    changes(0, 0x00000000);
    changes(1, 0x0000000B);
    changes(3, 0x000020F4);
    newstep(0xFD24C11E, 26);  // PC = 0468h
    changes(0, 0x0000000B);
    changes(1, 0x0000074D);
    changes(3, 0x000020F8);
    newstep(0x6C000103, 27);  // PC = 046Ch
    changes(2, 0x000021E4);
    changes(5, 0x0000040C);
    newstep(0x6C0000FC, 28);  // PC = 040Ch
    changes(2, 0x000021E0);
    changes(5, 0x000003F0);
    newstep(0x89AFC9FC, 29);  // PC = 03F0h
    changes(0, 0x0000000A);
    changes(2, 0x000021DC);
    newstep(0x289286DA, 30);  // PC = 03F4h
    changes(0, 0x00000048);
    changes(1, 0x0000000A);
    changes(2, 0x000021E4);
    changes(3, 0x000020F4);
    changes(5, 0x00000410);
    newstep(0x079000C0, 31);  // PC = 0410h
    changes(0, 0x000000C0);
    changes(1, 0x00000048);
    changes(3, 0x000020EC);
    newstep(0x5F900080, 32);  // PC = 0414h
    changes(0, 0x00000080);
    changes(1, 0x00000040);
    newstep(0x7DD40000, 33);  // PC = 0418h
    changes(0, 0x00000000);
    changes(1, 0x00000048);
    changes(3, 0x000020F0);
    newstep(0x49300109, 34);  // PC = 041Ch
    changes(0, 0x00000048);
    changes(1, 0x0000000A);
    changes(3, 0x000020F4);
    changes(5, 0x00000424);
    newstep(0x07900080, 35);  // PC = 0424h
    changes(0, 0x00000080);
    changes(1, 0x00000048);
    changes(3, 0x000020EC);
    newstep(0x5D24C118, 36);  // PC = 0428h
    changes(0, 0x00000048);
    changes(1, 0x0000000A);
    changes(3, 0x000020F4);
    changes(5, 0x00000460);
    newstep(0x09000000, 37);  // PC = 0460h
    changes(2, 0x000021E8);
    changes(5, 0x00000470);
    newstep(0x6C0000F2, 38);  // PC = 0470h
    changes(2, 0x000021E4);
    changes(5, 0x000003C8);
    newstep(0xE4000000, 39);  // PC = 03C8h
    changes(0, 0x00000000);
    changes(1, 0x00000048);
    changes(3, 0x000020F0);
    newstep(0x4C0000F0, 40);  // PC = 03CCh
    changes(5, 0x000003C0);
    newstep(0x9E7E6234, 41);  // PC = 03C0h
    changes(0, 0x00002234);
    changes(1, 0x00000000);
    changes(3, 0x000020EC);
    newstep(0xB83B9A08, 42);  // PC = 03C4h
    changes(0, 0x00000048);
    changes(1, 0x0000000A);
    changes(3, 0x000020F4);
    changes(5, 0x00000358);
    newstep(0x6C0000C9, 43);  // PC = 0358h
    changes(2, 0x000021E0);
    changes(5, 0x00000324);
    newstep(0x09000000, 44);  // PC = 0324h
    changes(2, 0x000021E4);
    changes(5, 0x0000035C);
    newstep(0x04400003, 45);  // PC = 035Ch
    changes(0, 0x00000001);
    changes(1, 0x00000048);
    changes(3, 0x000020F0);
    newstep(0x493000D6, 46);  // PC = 0360h
    changes(0, 0x00000048);
    changes(1, 0x0000000A);
    changes(3, 0x000020F4);
    newstep(0x10000002, 47);  // PC = 0364h
    changes(0, 0x00000000);
    newstep(0xAC240000, 48);  // PC = 0368h
    changes(0, 0x0000000A);
    changes(1, 0x0000074E);
    changes(2, 0x000021E8);
    changes(3, 0x000020F8);
    changes(5, 0x00000474);
    newstep(0x4C000119, 49);  // PC = 0474h
    changes(5, 0x00000464);
    newstep(0x07F27F14, 50);  // PC = 0464h
    changes(0, 0x00000000);
    changes(1, 0x0000000A);
    changes(3, 0x000020F4);
    newstep(0xFD24C11E, 51);  // PC = 0468h
    changes(0, 0x0000000A);
    changes(1, 0x0000074E);
    changes(3, 0x000020F8);
    newstep(0x6C000103, 52);  // PC = 046Ch
    changes(2, 0x000021E4);
    changes(5, 0x0000040C);
    newstep(0x6C0000FC, 53);  // PC = 040Ch
    changes(2, 0x000021E0);
    changes(5, 0x000003F0);
    newstep(0x89AFC9FC, 54);  // PC = 03F0h
    changes(0, 0x00000009);
    changes(2, 0x000021DC);
    newstep(0x289286DA, 55);  // PC = 03F4h
    changes(0, 0x00000065);
    changes(1, 0x00000009);
    changes(2, 0x000021E4);
    changes(3, 0x000020F4);
    changes(5, 0x00000410);
    newstep(0x079000C0, 56);  // PC = 0410h
    changes(0, 0x000000C0);
    changes(1, 0x00000065);
    changes(3, 0x000020EC);
    newstep(0x5F900080, 57);  // PC = 0414h
    changes(0, 0x00000080);
    changes(1, 0x00000040);
    newstep(0x7DD40000, 58);  // PC = 0418h
    changes(0, 0x00000000);
    changes(1, 0x00000065);
    changes(3, 0x000020F0);
    newstep(0x49300109, 59);  // PC = 041Ch
    changes(0, 0x00000065);
    changes(1, 0x00000009);
    changes(3, 0x000020F4);
    changes(5, 0x00000424);
    newstep(0x07900080, 60);  // PC = 0424h
    changes(0, 0x00000080);
    changes(1, 0x00000065);
    changes(3, 0x000020EC);
    newstep(0x5D24C118, 61);  // PC = 0428h
    changes(0, 0x00000065);
    changes(1, 0x00000009);
    changes(3, 0x000020F4);
    changes(5, 0x00000460);
    newstep(0x09000000, 62);  // PC = 0460h
    changes(2, 0x000021E8);
    changes(5, 0x00000470);
    newstep(0x6C0000F2, 63);  // PC = 0470h
    changes(2, 0x000021E4);
    changes(5, 0x000003C8);
    newstep(0xE4000000, 64);  // PC = 03C8h
    changes(0, 0x00000000);
    changes(1, 0x00000065);
    changes(3, 0x000020F0);
    newstep(0x4C0000F0, 65);  // PC = 03CCh
    changes(5, 0x000003C0);
    newstep(0x9E7E6234, 66);  // PC = 03C0h
    changes(0, 0x00002234);
    changes(1, 0x00000000);
    changes(3, 0x000020EC);
    newstep(0xB83B9A08, 67);  // PC = 03C4h
    changes(0, 0x00000065);
    changes(1, 0x00000009);
    changes(3, 0x000020F4);
    changes(5, 0x00000358);
    newstep(0x6C0000C9, 68);  // PC = 0358h
    changes(2, 0x000021E0);
    changes(5, 0x00000324);
    newstep(0x09000000, 69);  // PC = 0324h
    changes(2, 0x000021E4);
    changes(5, 0x0000035C);
    newstep(0x04400003, 70);  // PC = 035Ch
    changes(0, 0x00000001);
    changes(1, 0x00000065);
    changes(3, 0x000020F0);
    newstep(0x493000D6, 71);  // PC = 0360h
    changes(0, 0x00000065);
    changes(1, 0x00000009);
    changes(3, 0x000020F4);
    newstep(0x10000002, 72);  // PC = 0364h
    changes(0, 0x00000000);
    newstep(0xAC240000, 73);  // PC = 0368h
    changes(0, 0x00000009);
    changes(1, 0x0000074F);
    changes(2, 0x000021E8);
    changes(3, 0x000020F8);
    changes(5, 0x00000474);
    newstep(0x4C000119, 74);  // PC = 0474h
    changes(5, 0x00000464);
    newstep(0x07F27F14, 75);  // PC = 0464h
    changes(0, 0x00000000);
    changes(1, 0x00000009);
    changes(3, 0x000020F4);
    newstep(0xFD24C11E, 76);  // PC = 0468h
    changes(0, 0x00000009);
    changes(1, 0x0000074F);
    changes(3, 0x000020F8);
    newstep(0x6C000103, 77);  // PC = 046Ch
    changes(2, 0x000021E4);
    changes(5, 0x0000040C);
    newstep(0x6C0000FC, 78);  // PC = 040Ch
    changes(2, 0x000021E0);
    changes(5, 0x000003F0);
    newstep(0x89AFC9FC, 79);  // PC = 03F0h
    changes(0, 0x00000008);
    changes(2, 0x000021DC);
    newstep(0x289286DA, 80);  // PC = 03F4h
    changes(0, 0x0000006C);
    changes(1, 0x00000008);
    changes(2, 0x000021E4);
    changes(3, 0x000020F4);
    changes(5, 0x00000410);
    newstep(0x079000C0, 81);  // PC = 0410h
    changes(0, 0x000000C0);
    changes(1, 0x0000006C);
    changes(3, 0x000020EC);
    newstep(0x5F900080, 82);  // PC = 0414h
    changes(0, 0x00000080);
    changes(1, 0x00000040);
    newstep(0x7DD40000, 83);  // PC = 0418h
    changes(0, 0x00000000);
    changes(1, 0x0000006C);
    changes(3, 0x000020F0);
    newstep(0x49300109, 84);  // PC = 041Ch
    changes(0, 0x0000006C);
    changes(1, 0x00000008);
    changes(3, 0x000020F4);
    changes(5, 0x00000424);
    newstep(0x07900080, 85);  // PC = 0424h
    changes(0, 0x00000080);
    changes(1, 0x0000006C);
    changes(3, 0x000020EC);
    newstep(0x5D24C118, 86);  // PC = 0428h
    changes(0, 0x0000006C);
    changes(1, 0x00000008);
    changes(3, 0x000020F4);
    changes(5, 0x00000460);
    newstep(0x09000000, 87);  // PC = 0460h
    changes(2, 0x000021E8);
    changes(5, 0x00000470);
    newstep(0x6C0000F2, 88);  // PC = 0470h
    changes(2, 0x000021E4);
    changes(5, 0x000003C8);
    newstep(0xE4000000, 89);  // PC = 03C8h
    changes(0, 0x00000000);
    changes(1, 0x0000006C);
    changes(3, 0x000020F0);
    newstep(0x4C0000F0, 90);  // PC = 03CCh
    changes(5, 0x000003C0);
    newstep(0x9E7E6234, 91);  // PC = 03C0h
    changes(0, 0x00002234);
    changes(1, 0x00000000);
    changes(3, 0x000020EC);
    newstep(0xB83B9A08, 92);  // PC = 03C4h
    changes(0, 0x0000006C);
    changes(1, 0x00000008);
    changes(3, 0x000020F4);
    changes(5, 0x00000358);
    newstep(0x6C0000C9, 93);  // PC = 0358h
    changes(2, 0x000021E0);
    changes(5, 0x00000324);
    newstep(0x09000000, 94);  // PC = 0324h
    changes(2, 0x000021E4);
    changes(5, 0x0000035C);
    newstep(0x04400003, 95);  // PC = 035Ch
    changes(0, 0x00000001);
    changes(1, 0x0000006C);
    changes(3, 0x000020F0);
    newstep(0x493000D6, 96);  // PC = 0360h
    changes(0, 0x0000006C);
    changes(1, 0x00000008);
    changes(3, 0x000020F4);
    newstep(0x10000002, 97);  // PC = 0364h
    changes(0, 0x00000000);
    newstep(0xAC240000, 98);  // PC = 0368h
    changes(0, 0x00000008);
    changes(1, 0x00000750);
    changes(2, 0x000021E8);
    changes(3, 0x000020F8);
    changes(5, 0x00000474);
    newstep(0x4C000119, 99);  // PC = 0474h
    changes(5, 0x00000464);
    newstep(0x07F27F14, 100);  // PC = 0464h
    changes(0, 0x00000000);
    changes(1, 0x00000008);
    changes(3, 0x000020F4);
    newstep(0xFD24C11E, 101);  // PC = 0468h
    changes(0, 0x00000008);
    changes(1, 0x00000750);
    changes(3, 0x000020F8);
    newstep(0x6C000103, 102);  // PC = 046Ch
    changes(2, 0x000021E4);
    changes(5, 0x0000040C);
    newstep(0x6C0000FC, 103);  // PC = 040Ch
    changes(2, 0x000021E0);
    changes(5, 0x000003F0);
    newstep(0x89AFC9FC, 104);  // PC = 03F0h
    changes(0, 0x00000007);
    changes(2, 0x000021DC);
    newstep(0x289286DA, 105);  // PC = 03F4h
    changes(0, 0x0000006C);
    changes(1, 0x00000007);
    changes(2, 0x000021E4);
    changes(3, 0x000020F4);
    changes(5, 0x00000410);
    newstep(0x079000C0, 106);  // PC = 0410h
    changes(0, 0x000000C0);
    changes(1, 0x0000006C);
    changes(3, 0x000020EC);
    newstep(0x5F900080, 107);  // PC = 0414h
    changes(0, 0x00000080);
    changes(1, 0x00000040);
    newstep(0x7DD40000, 108);  // PC = 0418h
    changes(0, 0x00000000);
    changes(1, 0x0000006C);
    changes(3, 0x000020F0);
    newstep(0x49300109, 109);  // PC = 041Ch
    changes(0, 0x0000006C);
    changes(1, 0x00000007);
    changes(3, 0x000020F4);
    changes(5, 0x00000424);
    newstep(0x07900080, 110);  // PC = 0424h
    changes(0, 0x00000080);
    changes(1, 0x0000006C);
    changes(3, 0x000020EC);
    newstep(0x5D24C118, 111);  // PC = 0428h
    changes(0, 0x0000006C);
    changes(1, 0x00000007);
    changes(3, 0x000020F4);
    changes(5, 0x00000460);
    newstep(0x09000000, 112);  // PC = 0460h
    changes(2, 0x000021E8);
    changes(5, 0x00000470);
    newstep(0x6C0000F2, 113);  // PC = 0470h
    changes(2, 0x000021E4);
    changes(5, 0x000003C8);
    newstep(0xE4000000, 114);  // PC = 03C8h
    changes(0, 0x00000000);
    changes(1, 0x0000006C);
    changes(3, 0x000020F0);
    newstep(0x4C0000F0, 115);  // PC = 03CCh
    changes(5, 0x000003C0);
    newstep(0x9E7E6234, 116);  // PC = 03C0h
    changes(0, 0x00002234);
    changes(1, 0x00000000);
    changes(3, 0x000020EC);
    newstep(0xB83B9A08, 117);  // PC = 03C4h
    changes(0, 0x0000006C);
    changes(1, 0x00000007);
    changes(3, 0x000020F4);
    changes(5, 0x00000358);
    newstep(0x6C0000C9, 118);  // PC = 0358h
    changes(2, 0x000021E0);
    changes(5, 0x00000324);
    newstep(0x09000000, 119);  // PC = 0324h
    changes(2, 0x000021E4);
    changes(5, 0x0000035C);
    newstep(0x04400003, 120);  // PC = 035Ch
    changes(0, 0x00000001);
    changes(1, 0x0000006C);
    changes(3, 0x000020F0);
    newstep(0x493000D6, 121);  // PC = 0360h
    changes(0, 0x0000006C);
    changes(1, 0x00000007);
    changes(3, 0x000020F4);
    newstep(0x10000002, 122);  // PC = 0364h
    changes(0, 0x00000000);
    newstep(0xAC240000, 123);  // PC = 0368h
    changes(0, 0x00000007);
    changes(1, 0x00000751);
    changes(2, 0x000021E8);
    changes(3, 0x000020F8);
    changes(5, 0x00000474);
    newstep(0x4C000119, 124);  // PC = 0474h
    changes(5, 0x00000464);
    newstep(0x07F27F14, 125);  // PC = 0464h
    changes(0, 0x00000000);
    changes(1, 0x00000007);
    changes(3, 0x000020F4);
    newstep(0xFD24C11E, 126);  // PC = 0468h
    changes(0, 0x00000007);
    changes(1, 0x00000751);
    changes(3, 0x000020F8);
    newstep(0x6C000103, 127);  // PC = 046Ch
    changes(2, 0x000021E4);
    changes(5, 0x0000040C);
    newstep(0x6C0000FC, 128);  // PC = 040Ch
    changes(2, 0x000021E0);
    changes(5, 0x000003F0);
    newstep(0x89AFC9FC, 129);  // PC = 03F0h
    changes(0, 0x00000006);
    changes(2, 0x000021DC);
    newstep(0x289286DA, 130);  // PC = 03F4h
    changes(0, 0x0000006F);
    changes(1, 0x00000006);
    changes(2, 0x000021E4);
    changes(3, 0x000020F4);
    changes(5, 0x00000410);
    newstep(0x079000C0, 131);  // PC = 0410h
    changes(0, 0x000000C0);
    changes(1, 0x0000006F);
    changes(3, 0x000020EC);
    newstep(0x5F900080, 132);  // PC = 0414h
    changes(0, 0x00000080);
    changes(1, 0x00000040);
    newstep(0x7DD40000, 133);  // PC = 0418h
    changes(0, 0x00000000);
    changes(1, 0x0000006F);
    changes(3, 0x000020F0);
    newstep(0x49300109, 134);  // PC = 041Ch
    changes(0, 0x0000006F);
    changes(1, 0x00000006);
    changes(3, 0x000020F4);
    changes(5, 0x00000424);
    newstep(0x07900080, 135);  // PC = 0424h
    changes(0, 0x00000080);
    changes(1, 0x0000006F);
    changes(3, 0x000020EC);
    newstep(0x5D24C118, 136);  // PC = 0428h
    changes(0, 0x0000006F);
    changes(1, 0x00000006);
    changes(3, 0x000020F4);
    changes(5, 0x00000460);
    newstep(0x09000000, 137);  // PC = 0460h
    changes(2, 0x000021E8);
    changes(5, 0x00000470);
    newstep(0x6C0000F2, 138);  // PC = 0470h
    changes(2, 0x000021E4);
    changes(5, 0x000003C8);
    newstep(0xE4000000, 139);  // PC = 03C8h
    changes(0, 0x00000000);
    changes(1, 0x0000006F);
    changes(3, 0x000020F0);
    newstep(0x4C0000F0, 140);  // PC = 03CCh
    changes(5, 0x000003C0);
    newstep(0x9E7E6234, 141);  // PC = 03C0h
    changes(0, 0x00002234);
    changes(1, 0x00000000);
    changes(3, 0x000020EC);
    newstep(0xB83B9A08, 142);  // PC = 03C4h
    changes(0, 0x0000006F);
    changes(1, 0x00000006);
    changes(3, 0x000020F4);
    changes(5, 0x00000358);
    newstep(0x6C0000C9, 143);  // PC = 0358h
    changes(2, 0x000021E0);
    changes(5, 0x00000324);
    newstep(0x09000000, 144);  // PC = 0324h
    changes(2, 0x000021E4);
    changes(5, 0x0000035C);
    newstep(0x04400003, 145);  // PC = 035Ch
    changes(0, 0x00000001);
    changes(1, 0x0000006F);
    changes(3, 0x000020F0);
    newstep(0x493000D6, 146);  // PC = 0360h
    changes(0, 0x0000006F);
    changes(1, 0x00000006);
    changes(3, 0x000020F4);
    newstep(0x10000002, 147);  // PC = 0364h
    changes(0, 0x00000000);
    newstep(0xAC240000, 148);  // PC = 0368h
    changes(0, 0x00000006);
    changes(1, 0x00000752);
    changes(2, 0x000021E8);
    changes(3, 0x000020F8);
    changes(5, 0x00000474);
    newstep(0x4C000119, 149);  // PC = 0474h
    changes(5, 0x00000464);
    newstep(0x07F27F14, 150);  // PC = 0464h
    changes(0, 0x00000000);
    changes(1, 0x00000006);
    changes(3, 0x000020F4);
    newstep(0xFD24C11E, 151);  // PC = 0468h
    changes(0, 0x00000006);
    changes(1, 0x00000752);
    changes(3, 0x000020F8);
    newstep(0x6C000103, 152);  // PC = 046Ch
    changes(2, 0x000021E4);
    changes(5, 0x0000040C);
    newstep(0x6C0000FC, 153);  // PC = 040Ch
    changes(2, 0x000021E0);
    changes(5, 0x000003F0);
    newstep(0x89AFC9FC, 154);  // PC = 03F0h
    changes(0, 0x00000005);
    changes(2, 0x000021DC);
    newstep(0x289286DA, 155);  // PC = 03F4h
    changes(0, 0x00000020);
    changes(1, 0x00000005);
    changes(2, 0x000021E4);
    changes(3, 0x000020F4);
    changes(5, 0x00000410);
    newstep(0x079000C0, 156);  // PC = 0410h
    changes(0, 0x000000C0);
    changes(1, 0x00000020);
    changes(3, 0x000020EC);
    newstep(0x5F900080, 157);  // PC = 0414h
    changes(0, 0x00000080);
    changes(1, 0x00000000);
    newstep(0x7DD40000, 158);  // PC = 0418h
    changes(0, 0x00000000);
    changes(1, 0x00000020);
    changes(3, 0x000020F0);
    newstep(0x49300109, 159);  // PC = 041Ch
    changes(0, 0x00000020);
    changes(1, 0x00000005);
    changes(3, 0x000020F4);
    changes(5, 0x00000424);
    newstep(0x07900080, 160);  // PC = 0424h
    changes(0, 0x00000080);
    changes(1, 0x00000020);
    changes(3, 0x000020EC);
    newstep(0x5D24C118, 161);  // PC = 0428h
    changes(0, 0x00000020);
    changes(1, 0x00000005);
    changes(3, 0x000020F4);
    changes(5, 0x00000460);
    newstep(0x09000000, 162);  // PC = 0460h
    changes(2, 0x000021E8);
    changes(5, 0x00000470);
    newstep(0x6C0000F2, 163);  // PC = 0470h
    changes(2, 0x000021E4);
    changes(5, 0x000003C8);
    newstep(0xE4000000, 164);  // PC = 03C8h
    changes(0, 0x00000000);
    changes(1, 0x00000020);
    changes(3, 0x000020F0);
    newstep(0x4C0000F0, 165);  // PC = 03CCh
    changes(5, 0x000003C0);
    newstep(0x9E7E6234, 166);  // PC = 03C0h
    changes(0, 0x00002234);
    changes(1, 0x00000000);
    changes(3, 0x000020EC);
    newstep(0xB83B9A08, 167);  // PC = 03C4h
    changes(0, 0x00000020);
    changes(1, 0x00000005);
    changes(3, 0x000020F4);
    changes(5, 0x00000358);
    newstep(0x6C0000C9, 168);  // PC = 0358h
    changes(2, 0x000021E0);
    changes(5, 0x00000324);
    newstep(0x09000000, 169);  // PC = 0324h
    changes(2, 0x000021E4);
    changes(5, 0x0000035C);
    newstep(0x04400003, 170);  // PC = 035Ch
    changes(0, 0x00000001);
    changes(1, 0x00000020);
    changes(3, 0x000020F0);
    newstep(0x493000D6, 171);  // PC = 0360h
    changes(0, 0x00000020);
    changes(1, 0x00000005);
    changes(3, 0x000020F4);
    newstep(0x10000002, 172);  // PC = 0364h
    changes(0, 0x00000000);
    newstep(0xAC240000, 173);  // PC = 0368h
    changes(0, 0x00000005);
    changes(1, 0x00000753);
    changes(2, 0x000021E8);
    changes(3, 0x000020F8);
    changes(5, 0x00000474);
    newstep(0x4C000119, 174);  // PC = 0474h
    changes(5, 0x00000464);
    newstep(0x07F27F14, 175);  // PC = 0464h
    changes(0, 0x00000000);
    changes(1, 0x00000005);
    changes(3, 0x000020F4);
    newstep(0xFD24C11E, 176);  // PC = 0468h
    changes(0, 0x00000005);
    changes(1, 0x00000753);
    changes(3, 0x000020F8);
    newstep(0x6C000103, 177);  // PC = 046Ch
    changes(2, 0x000021E4);
    changes(5, 0x0000040C);
    newstep(0x6C0000FC, 178);  // PC = 040Ch
    changes(2, 0x000021E0);
    changes(5, 0x000003F0);
    newstep(0x89AFC9FC, 179);  // PC = 03F0h
    changes(0, 0x00000004);
    changes(2, 0x000021DC);
    newstep(0x289286DA, 180);  // PC = 03F4h
    changes(0, 0x00000057);
    changes(1, 0x00000004);
    changes(2, 0x000021E4);
    changes(3, 0x000020F4);
    changes(5, 0x00000410);
    newstep(0x079000C0, 181);  // PC = 0410h
    changes(0, 0x000000C0);
    changes(1, 0x00000057);
    changes(3, 0x000020EC);
    newstep(0x5F900080, 182);  // PC = 0414h
    changes(0, 0x00000080);
    changes(1, 0x00000040);
    newstep(0x7DD40000, 183);  // PC = 0418h
    changes(0, 0x00000000);
    changes(1, 0x00000057);
    changes(3, 0x000020F0);
    newstep(0x49300109, 184);  // PC = 041Ch
    changes(0, 0x00000057);
    changes(1, 0x00000004);
    changes(3, 0x000020F4);
    changes(5, 0x00000424);
    newstep(0x07900080, 185);  // PC = 0424h
    changes(0, 0x00000080);
    changes(1, 0x00000057);
    changes(3, 0x000020EC);
    newstep(0x5D24C118, 186);  // PC = 0428h
    changes(0, 0x00000057);
    changes(1, 0x00000004);
    changes(3, 0x000020F4);
    changes(5, 0x00000460);
    newstep(0x09000000, 187);  // PC = 0460h
    changes(2, 0x000021E8);
    changes(5, 0x00000470);
    newstep(0x6C0000F2, 188);  // PC = 0470h
    changes(2, 0x000021E4);
    changes(5, 0x000003C8);
    newstep(0xE4000000, 189);  // PC = 03C8h
    changes(0, 0x00000000);
    changes(1, 0x00000057);
    changes(3, 0x000020F0);
    newstep(0x4C0000F0, 190);  // PC = 03CCh
    changes(5, 0x000003C0);
    newstep(0x9E7E6234, 191);  // PC = 03C0h
    changes(0, 0x00002234);
    changes(1, 0x00000000);
    changes(3, 0x000020EC);
    newstep(0xB83B9A08, 192);  // PC = 03C4h
    changes(0, 0x00000057);
    changes(1, 0x00000004);
    changes(3, 0x000020F4);
    changes(5, 0x00000358);
    newstep(0x6C0000C9, 193);  // PC = 0358h
    changes(2, 0x000021E0);
    changes(5, 0x00000324);
    newstep(0x09000000, 194);  // PC = 0324h
    changes(2, 0x000021E4);
    changes(5, 0x0000035C);
    newstep(0x04400003, 195);  // PC = 035Ch
    changes(0, 0x00000001);
    changes(1, 0x00000057);
    changes(3, 0x000020F0);
    newstep(0x493000D6, 196);  // PC = 0360h
    changes(0, 0x00000057);
    changes(1, 0x00000004);
    changes(3, 0x000020F4);
    newstep(0x10000002, 197);  // PC = 0364h
    changes(0, 0x00000000);
    newstep(0xAC240000, 198);  // PC = 0368h
    changes(0, 0x00000004);
    changes(1, 0x00000754);
    changes(2, 0x000021E8);
    changes(3, 0x000020F8);
    changes(5, 0x00000474);
    newstep(0x4C000119, 199);  // PC = 0474h
    changes(5, 0x00000464);
    newstep(0, -1);  // make sure last group has all changes listed.

    printf("\n %d tests, %d errors\n", tests-1, errors);
return 0;
}
